# Backend PR Review: {{title}}

> Generated by jaan.to backend-pr-review | {{date}}

---

## Executive Summary

{{executive_summary}}

**Verdict: {{verdict}}**

---

## PR Metadata

| Field | Value |
|-------|-------|
| Repository | {{repository}} |
| PR/MR | #{{pr_number}} -- {{pr_title}} |
| Platform | {{platform}} |
| Stack | {{stack_key}} ({{framework}} v{{framework_version}}) |
| Files Reviewed | {{files_count}} backend files |
| Changes | +{{additions}} / -{{deletions}} lines |
| Review Date | {{date}} |

---

## Findings

### CRITICAL ({{critical_count}})

{{#each critical_findings}}
#### {{title}}

- **File**: `{{file}}` (Lines {{start_line}}--{{end_line}})
- **Category**: {{category}}
- **Confidence**: {{confidence}}

**Problem**: {{description}}

**Vulnerable code**:
```{{lang}}
{{vulnerable_code}}
```

**Fix**:
```{{lang}}
{{fixed_code}}
```

---
{{/each}}

### WARNING ({{warning_count}})

{{#each warning_findings}}
#### {{title}}

- **File**: `{{file}}` (Lines {{start_line}}--{{end_line}})
- **Category**: {{category}}
- **Confidence**: {{confidence}}

**Problem**: {{description}}

{{#if fixed_code}}
**Suggestion**:
```{{lang}}
{{fixed_code}}
```
{{/if}}

---
{{/each}}

### INFO ({{info_count}})

{{#each info_findings}}
#### {{title}}

- **File**: `{{file}}` (Lines {{start_line}}--{{end_line}})
- **Category**: {{category}}

{{description}}

---
{{/each}}

## Review Categories

### Security Assessment

{{security_assessment}}

### Code Quality Assessment

{{code_quality_assessment}}

### Backend Patterns Assessment

{{backend_patterns_assessment}}

### Testing Assessment

{{testing_assessment}}

### Database Assessment

{{database_assessment}}

### Performance Assessment

{{performance_assessment}}

---

## Risk Score

| File | Risk Score | Factors |
|------|-----------|---------|
{{#each risk_files}}
| `{{file}}` | {{score}}/100 | {{factors}} |
{{/each}}

---

## Methodology

This review was conducted using a two-pass analysis workflow:
1. **Context gathering** -- Stack detection via tech.md, project config, review standards
2. **Diff analysis** -- {{files_count}} files, +{{additions}} / -{{deletions}} lines
3. **Deterministic security scan** -- Stack-specific grep patterns from reference files
4. **Two-pass LLM analysis** -- Pass 1 (liberal, confidence >= 50), Pass 2 (conservative, variable thresholds)
5. **Risk-based prioritization** -- Files ranked by criticality, change size, finding density
6. **Output formatting** -- Severity-grouped, confidence-filtered

### Confidence Thresholds

| Severity | Min Confidence |
|----------|---------------|
| CRITICAL | >= 90 |
| WARNING | >= 85 |
| INFO | >= 80 |

Total findings analyzed: {{total_raw_findings}} | Included: {{included_findings}} | Filtered: {{filtered_findings}}

---

## Metadata

| Field | Value |
|-------|-------|
| Generated | {{date}} |
| Skill | backend-pr-review |
| Version | 3.0 |
