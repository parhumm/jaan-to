<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LiveClassroom Component Preview | EduStream Academy</title>

  <!-- Plus Jakarta Sans — distinctive warm geometric sans-serif -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ─── CSS Custom Properties (Design Tokens) ────────────────────── */
    :root {
      --color-bg: #F8F7F4;
      --color-surface: #FFFFFF;
      --color-border: #E7E5E4;
      --color-text: #1C1917;
      --color-text-secondary: #78716C;
      --color-text-muted: #A8A29E;
      --color-primary: #3B82F6;
      --color-primary-hover: #2563EB;
      --color-danger: #EF4444;
      --color-danger-hover: #DC2626;
      --color-success: #10B981;
      --color-warning: #F59E0B;
      --color-muted-bg: #F5F5F4;
      --radius-sm: 0.5rem;
      --radius-md: 0.75rem;
      --radius-lg: 1rem;
      --radius-xl: 1.5rem;
      --shadow-sm: 0 1px 2px rgba(28, 25, 23, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(28, 25, 23, 0.07), 0 2px 4px -2px rgba(28, 25, 23, 0.05);
      --shadow-lg: 0 10px 15px -3px rgba(28, 25, 23, 0.08), 0 4px 6px -4px rgba(28, 25, 23, 0.04);
      --font-family: 'Plus Jakarta Sans', system-ui, -apple-system, sans-serif;
    }

    [data-theme="dark"] {
      --color-bg: #1C1917;
      --color-surface: #292524;
      --color-border: #44403C;
      --color-text: #F5F5F4;
      --color-text-secondary: #A8A29E;
      --color-text-muted: #78716C;
      --color-muted-bg: #292524;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--font-family);
      background: var(--color-bg);
      color: var(--color-text);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
    }

    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes speakingBar { from { transform: scaleY(0.4); } to { transform: scaleY(1.3); } }
    @keyframes slideInUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
    }

    .app { display: flex; flex-direction: column; height: 100vh; height: 100dvh; }

    /* Header */
    .header { display: flex; align-items: center; justify-content: space-between; padding: 0.625rem 1rem; border-bottom: 1px solid var(--color-border); background: var(--color-surface); }
    .header-left { display: flex; align-items: center; gap: 0.75rem; }
    .header h1 { font-size: 0.875rem; font-weight: 600; color: var(--color-text); }
    .status-badge { display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.125rem 0.5rem; border-radius: 9999px; font-size: 0.6875rem; font-weight: 500; background: #ECFDF5; color: #047857; }
    [data-theme="dark"] .status-badge { background: rgba(16, 185, 129, 0.15); color: #34D399; }
    .status-dot { width: 0.375rem; height: 0.375rem; border-radius: 50%; background: #10B981; animation: pulse 2s infinite; }
    .header-right { display: flex; align-items: center; gap: 0.5rem; }
    .session-count { font-size: 0.75rem; color: var(--color-text-muted); }

    /* Content */
    .content { display: flex; flex: 1; min-height: 0; }
    .video-area { flex: 1; display: flex; flex-direction: column; gap: 1rem; padding: 1rem; overflow-y: auto; }

    /* Instructor Stage */
    .instructor-stage { position: relative; }
    .instructor-card { border-radius: var(--radius-xl); background: var(--color-surface); padding: 0.25rem; box-shadow: var(--shadow-lg); }
    .video-tile { position: relative; overflow: hidden; border-radius: calc(var(--radius-xl) - 0.125rem); background: var(--color-muted-bg); }
    .video-tile--lg { aspect-ratio: 16 / 9; }
    .video-tile--sm { aspect-ratio: 4 / 3; }
    .video-tile--speaking { outline: 2px solid var(--color-primary); outline-offset: 2px; }

    .video-avatar { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: #D6D3D1; }
    [data-theme="dark"] .video-avatar { background: #57534E; }
    .avatar-circle { display: flex; align-items: center; justify-content: center; border-radius: 50%; background: #A8A29E; color: #57534E; font-weight: 600; }
    [data-theme="dark"] .avatar-circle { background: #44403C; color: #D6D3D1; }
    .avatar-circle--lg { width: 5rem; height: 5rem; font-size: 1.5rem; }
    .avatar-circle--sm { width: 3rem; height: 3rem; font-size: 0.875rem; }

    .video-placeholder { position: absolute; inset: 0; background: linear-gradient(135deg, #A8A29E 0%, #78716C 100%); }
    [data-theme="dark"] .video-placeholder { background: linear-gradient(135deg, #57534E 0%, #44403C 100%); }

    .video-overlay { position: absolute; inset-inline: 0; bottom: 0; padding: 1.5rem 0.75rem 0.5rem; background: linear-gradient(to top, rgba(0,0,0,0.6), transparent); display: flex; align-items: center; gap: 0.375rem; }
    .video-name { font-size: 0.75rem; font-weight: 500; color: #FFFFFF; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .video-muted-icon { flex-shrink: 0; width: 0.875rem; height: 0.875rem; color: #F87171; }

    .connection-dot { position: absolute; top: 0.5rem; right: 0.5rem; width: 0.5rem; height: 0.5rem; border-radius: 50%; }
    .connection-dot--connected { background: #34D399; }
    .connection-dot--reconnecting { background: #FBBF24; animation: pulse 1.5s infinite; }
    .connection-dot--disconnected { background: #F87171; }

    .speaking-bars { position: absolute; top: 0.5rem; left: 0.5rem; display: flex; align-items: flex-end; gap: 2px; }
    .speaking-bar { width: 2px; border-radius: 1px; background: var(--color-primary); }
    .speaking-bar:nth-child(1) { height: 8px; animation: speakingBar 0.5s ease-in-out infinite alternate; }
    .speaking-bar:nth-child(2) { height: 12px; animation: speakingBar 0.5s ease-in-out 0.15s infinite alternate; }
    .speaking-bar:nth-child(3) { height: 6px; animation: speakingBar 0.5s ease-in-out 0.3s infinite alternate; }

    .live-badge { position: absolute; top: 1rem; left: 1rem; z-index: 10; display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.25rem 0.625rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; color: var(--color-text); background: rgba(255, 255, 255, 0.9); box-shadow: var(--shadow-sm); backdrop-filter: blur(8px); }
    [data-theme="dark"] .live-badge { background: rgba(41, 37, 36, 0.9); color: #E7E5E4; }
    .live-dot { width: 0.375rem; height: 0.375rem; border-radius: 50%; background: #EF4444; animation: pulse 2s infinite; }

    /* Participant Grid */
    .participant-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem; }
    @media (max-width: 1280px) { .participant-grid { grid-template-columns: repeat(4, 1fr); } }
    @media (max-width: 768px) { .participant-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 480px) { .participant-grid { grid-template-columns: repeat(2, 1fr); } }

    .overflow-tile { aspect-ratio: 4 / 3; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-lg); background: var(--color-muted-bg); font-size: 0.875rem; font-weight: 500; color: var(--color-text-secondary); }

    /* Sidebar */
    .sidebar { width: 20rem; flex-shrink: 0; display: flex; flex-direction: column; border-left: 1px solid var(--color-border); background: var(--color-surface); }
    @media (max-width: 1024px) { .sidebar { position: fixed; inset-block: 0; right: 0; z-index: 40; box-shadow: -4px 0 24px rgba(0,0,0,0.15); } .sidebar.sidebar-hidden { transform: translateX(100%); } }

    .sidebar-tabs { display: flex; border-bottom: 1px solid var(--color-border); }
    .sidebar-tab { flex: 1; padding: 0.625rem 1rem; border: none; background: none; font-family: var(--font-family); font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-text-muted); cursor: pointer; border-bottom: 2px solid transparent; transition: color 0.2s, border-color 0.2s; }
    .sidebar-tab:hover { color: var(--color-text-secondary); }
    .sidebar-tab--active { color: var(--color-primary); border-bottom-color: var(--color-primary); }

    .tab-content { flex: 1; min-height: 0; display: flex; flex-direction: column; }

    /* Chat */
    .chat-messages { flex: 1; overflow-y: auto; padding: 0.75rem 1rem; }
    .chat-message { display: flex; align-items: flex-start; gap: 0.625rem; margin-bottom: 0.75rem; animation: slideInUp 0.2s ease-out; }
    .chat-avatar { width: 1.75rem; height: 1.75rem; border-radius: 50%; background: #E7E5E4; display: flex; align-items: center; justify-content: center; font-size: 0.625rem; font-weight: 600; color: #78716C; flex-shrink: 0; }
    [data-theme="dark"] .chat-avatar { background: #44403C; color: #D6D3D1; }
    .chat-body { min-width: 0; flex: 1; }
    .chat-header { display: flex; align-items: baseline; gap: 0.5rem; }
    .chat-sender { font-size: 0.75rem; font-weight: 600; color: var(--color-text); }
    .chat-time { font-size: 0.625rem; color: var(--color-text-muted); }
    .chat-text { margin-top: 0.125rem; font-size: 0.875rem; line-height: 1.6; color: var(--color-text-secondary); }

    .chat-input-area { border-top: 1px solid var(--color-border); padding: 0.75rem 1rem; display: flex; align-items: flex-end; gap: 0.5rem; }
    .chat-input { flex: 1; resize: none; border: 1px solid var(--color-border); border-radius: var(--radius-md); background: var(--color-muted-bg); padding: 0.5rem 0.75rem; font-family: var(--font-family); font-size: 0.875rem; color: var(--color-text); outline: none; transition: border-color 0.2s, box-shadow 0.2s; }
    .chat-input::placeholder { color: var(--color-text-muted); }
    .chat-input:focus { border-color: var(--color-primary); box-shadow: 0 0 0 1px var(--color-primary); }

    .chat-send-btn { display: flex; align-items: center; justify-content: center; width: 2.25rem; height: 2.25rem; flex-shrink: 0; border: none; border-radius: var(--radius-md); background: var(--color-primary); color: white; cursor: pointer; transition: background 0.2s; }
    .chat-send-btn:hover { background: var(--color-primary-hover); }
    .chat-send-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .chat-send-btn svg { width: 1rem; height: 1rem; }

    /* Participant List */
    .participant-search { padding: 0.75rem 1rem; }
    .search-input { width: 100%; border: 1px solid var(--color-border); border-radius: var(--radius-md); background: var(--color-muted-bg); padding: 0.5rem 0.75rem; font-family: var(--font-family); font-size: 0.875rem; color: var(--color-text); outline: none; transition: border-color 0.2s, box-shadow 0.2s; }
    .search-input::placeholder { color: var(--color-text-muted); }
    .search-input:focus { border-color: var(--color-primary); box-shadow: 0 0 0 1px var(--color-primary); }

    .participant-list { flex: 1; overflow-y: auto; padding: 0 1rem; list-style: none; }
    .participant-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; border-radius: var(--radius-md); transition: background 0.15s; }
    .participant-item:hover { background: var(--color-muted-bg); }

    .participant-avatar-wrap { position: relative; }
    .participant-avatar { width: 2rem; height: 2rem; border-radius: 50%; background: #E7E5E4; display: flex; align-items: center; justify-content: center; font-size: 0.6875rem; font-weight: 600; color: #78716C; }
    [data-theme="dark"] .participant-avatar { background: #44403C; color: #D6D3D1; }
    .participant-status-dot { position: absolute; bottom: -2px; right: -2px; width: 0.625rem; height: 0.625rem; border-radius: 50%; border: 2px solid var(--color-surface); }
    .participant-name { flex: 1; min-width: 0; font-size: 0.875rem; font-weight: 500; color: var(--color-text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .participant-icons { display: flex; align-items: center; gap: 0.25rem; font-size: 0.875rem; }
    .participant-count { border-top: 1px solid var(--color-border); padding: 0.5rem 1rem; font-size: 0.75rem; color: var(--color-text-muted); }

    /* Toolbar */
    .toolbar-wrap { display: flex; justify-content: center; padding: 0.5rem 0 1rem; }
    .toolbar { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; border-radius: var(--radius-xl); border: 1px solid var(--color-border); background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); box-shadow: var(--shadow-lg); }
    [data-theme="dark"] .toolbar { background: rgba(28, 25, 23, 0.8); }

    .toolbar-btn { position: relative; display: flex; align-items: center; justify-content: center; width: 2.75rem; height: 2.75rem; border: none; border-radius: var(--radius-lg); background: var(--color-surface); color: var(--color-text-secondary); cursor: pointer; box-shadow: var(--shadow-sm); transition: all 0.2s; }
    .toolbar-btn:hover { background: var(--color-muted-bg); }
    .toolbar-btn:focus-visible { outline: 2px solid var(--color-primary); outline-offset: 2px; }
    .toolbar-btn svg { width: 1.25rem; height: 1.25rem; }

    .toolbar-btn--active { background: #FEE2E2; color: #DC2626; }
    [data-theme="dark"] .toolbar-btn--active { background: rgba(239, 68, 68, 0.15); color: #F87171; }
    .toolbar-btn--active:hover { background: #FECACA; }
    [data-theme="dark"] .toolbar-btn--active:hover { background: rgba(239, 68, 68, 0.25); }

    .toolbar-btn--danger { background: var(--color-danger); color: white; box-shadow: none; }
    .toolbar-btn--danger:hover { background: var(--color-danger-hover); }

    .toolbar-separator { width: 1px; height: 1.5rem; background: var(--color-border); margin: 0 0.25rem; }

    .toolbar-btn .tooltip { position: absolute; bottom: calc(100% + 0.5rem); left: 50%; transform: translateX(-50%); white-space: nowrap; padding: 0.25rem 0.625rem; border-radius: var(--radius-sm); background: #292524; color: white; font-size: 0.75rem; font-weight: 500; pointer-events: none; opacity: 0; transition: opacity 0.15s; }
    .toolbar-btn:hover .tooltip { opacity: 1; }
    .tooltip kbd { margin-left: 0.375rem; padding: 0.0625rem 0.25rem; border-radius: 0.25rem; background: #44403C; font-family: var(--font-family); font-size: 0.625rem; color: #A8A29E; }

    .hand-emoji { font-size: 0.875rem; }
    .hand-emoji--muted { filter: grayscale(1); opacity: 0.6; }

    /* Preview Controls */
    .preview-controls { position: fixed; top: 0.5rem; right: 0.5rem; z-index: 100; display: flex; gap: 0.25rem; padding: 0.25rem; border-radius: var(--radius-sm); background: var(--color-surface); border: 1px solid var(--color-border); box-shadow: var(--shadow-md); }
    .preview-btn { padding: 0.25rem 0.5rem; border: none; border-radius: 0.25rem; background: transparent; font-family: var(--font-family); font-size: 0.6875rem; font-weight: 500; color: var(--color-text-secondary); cursor: pointer; transition: background 0.15s; }
    .preview-btn:hover { background: var(--color-muted-bg); }
    .preview-btn--active { background: var(--color-primary); color: white; }
    .preview-btn--active:hover { background: var(--color-primary-hover); }

    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }
  </style>
</head>
<body>
  <!-- Preview controls (theme toggle) -->
  <div class="preview-controls">
    <button class="preview-btn preview-btn--active" id="lightBtn" onclick="setTheme('light')">Light</button>
    <button class="preview-btn" id="darkBtn" onclick="setTheme('dark')">Dark</button>
  </div>

  <div class="app" id="app">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1>Live Classroom</h1>
        <span class="status-badge">
          <span class="status-dot"></span>
          Connected
        </span>
      </div>
      <div class="header-right">
        <span class="session-count">16 in session</span>
      </div>
    </header>

    <!-- Main content -->
    <div class="content">
      <!-- Video area -->
      <main class="video-area" id="instructor-video">
        <!-- Instructor Stage -->
        <section class="instructor-stage" aria-label="Instructor video">
          <div class="instructor-card">
            <div class="video-tile video-tile--lg video-tile--speaking">
              <div class="video-placeholder"></div>
              <div class="video-overlay">
                <span class="video-name">Prof. Sarah Chen</span>
              </div>
              <div class="connection-dot connection-dot--connected"></div>
              <div class="speaking-bars">
                <div class="speaking-bar"></div>
                <div class="speaking-bar"></div>
                <div class="speaking-bar"></div>
              </div>
            </div>
          </div>
          <div class="live-badge">
            <span class="live-dot"></span>
            LIVE
          </div>
        </section>

        <!-- Participant Grid (populated by JS using safe DOM methods) -->
        <section aria-label="Participants (15)">
          <div class="participant-grid" id="participantGrid"></div>
        </section>
      </main>

      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar" aria-label="Session sidebar">
        <div class="sidebar-tabs" role="tablist">
          <button class="sidebar-tab sidebar-tab--active" role="tab" aria-selected="true" id="chatTab" onclick="switchTab('chat')">Chat</button>
          <button class="sidebar-tab" role="tab" aria-selected="false" id="participantsTab" onclick="switchTab('participants')">Participants (15)</button>
        </div>

        <!-- Chat Panel -->
        <div class="tab-content" id="chatPanel" role="tabpanel">
          <div class="chat-messages" id="chatMessages" role="log" aria-label="Chat messages" aria-live="polite"></div>
          <div class="chat-input-area">
            <textarea class="chat-input" placeholder="Type a message..." rows="1" aria-label="Chat message input" id="chatInput"></textarea>
            <button class="chat-send-btn" aria-label="Send message" onclick="sendMessage()">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Participant List Panel -->
        <div class="tab-content" id="participantListPanel" role="tabpanel" style="display: none;">
          <div class="participant-search">
            <input type="search" class="search-input" placeholder="Search participants..." aria-label="Search participants">
          </div>
          <ul class="participant-list" id="participantList" role="list" aria-label="Participant list"></ul>
          <div class="participant-count">16 participants</div>
        </div>
      </aside>
    </div>

    <!-- Toolbar -->
    <div class="toolbar-wrap">
      <nav class="toolbar" role="toolbar" aria-label="Session controls">
        <button class="toolbar-btn" aria-label="Mute" aria-pressed="false" id="micBtn" onclick="toggleMic()">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" />
          </svg>
          <span class="tooltip">Mute<kbd>M</kbd></span>
        </button>

        <button class="toolbar-btn" aria-label="Turn off camera" aria-pressed="false" id="cameraBtn" onclick="toggleCamera()">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z" />
          </svg>
          <span class="tooltip">Camera<kbd>V</kbd></span>
        </button>

        <div class="toolbar-separator" role="separator"></div>

        <button class="toolbar-btn" aria-label="Raise hand" aria-pressed="false" id="handBtn" onclick="toggleHand()">
          <span class="hand-emoji hand-emoji--muted">✋</span>
          <span class="tooltip">Raise hand<kbd>H</kbd></span>
        </button>

        <button class="toolbar-btn" aria-label="Share screen" aria-pressed="false">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25A2.25 2.25 0 015.25 3h13.5A2.25 2.25 0 0121 5.25z" />
          </svg>
          <span class="tooltip">Share screen<kbd>S</kbd></span>
        </button>

        <div class="toolbar-separator" role="separator"></div>

        <button class="toolbar-btn toolbar-btn--danger" aria-label="Leave session">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" />
          </svg>
          <span class="tooltip">Leave<kbd>L</kbd></span>
        </button>
      </nav>
    </div>
  </div>

  <script>
    // ─── Mock Data ──────────────────────────────────────────────────
    var participants = [
      { id: '1', name: 'Alex Rivera', isMuted: false, isCameraOff: false, isSpeaking: true, isHandRaised: false, connectionStatus: 'connected' },
      { id: '2', name: 'Priya Sharma', isMuted: true, isCameraOff: false, isSpeaking: false, isHandRaised: true, connectionStatus: 'connected' },
      { id: '3', name: 'James Wilson', isMuted: false, isCameraOff: true, isSpeaking: false, isHandRaised: false, connectionStatus: 'connected' },
      { id: '4', name: 'Mei Lin', isMuted: true, isCameraOff: false, isSpeaking: false, isHandRaised: false, connectionStatus: 'connected' },
      { id: '5', name: 'Omar Hassan', isMuted: false, isCameraOff: false, isSpeaking: false, isHandRaised: false, connectionStatus: 'reconnecting' },
      { id: '6', name: 'Sofia Garcia', isMuted: false, isCameraOff: true, isSpeaking: false, isHandRaised: false, connectionStatus: 'connected' },
      { id: '7', name: 'Yuki Tanaka', isMuted: true, isCameraOff: false, isSpeaking: false, isHandRaised: false, connectionStatus: 'connected' },
      { id: '8', name: 'Liam O\'Brien', isMuted: false, isCameraOff: false, isSpeaking: false, isHandRaised: true, connectionStatus: 'connected' },
      { id: '9', name: 'Aisha Patel', isMuted: false, isCameraOff: false, isSpeaking: false, isHandRaised: false, connectionStatus: 'connected' },
      { id: '10', name: 'David Kim', isMuted: true, isCameraOff: true, isSpeaking: false, isHandRaised: false, connectionStatus: 'connected' },
      { id: '11', name: 'Emma Thompson', isMuted: false, isCameraOff: false, isSpeaking: false, isHandRaised: false, connectionStatus: 'connected' },
      { id: '12', name: 'Carlos Mendez', isMuted: false, isCameraOff: false, isSpeaking: false, isHandRaised: false, connectionStatus: 'disconnected' },
      { id: '13', name: 'Nina Kowalski', isMuted: true, isCameraOff: false, isSpeaking: false, isHandRaised: false, connectionStatus: 'connected' },
      { id: '14', name: 'Ryan Chen', isMuted: false, isCameraOff: true, isSpeaking: false, isHandRaised: false, connectionStatus: 'connected' },
      { id: '15', name: 'Fatima Al-Rashid', isMuted: false, isCameraOff: false, isSpeaking: false, isHandRaised: false, connectionStatus: 'connected' }
    ];

    var chatMessages = [
      { id: 'c1', senderName: 'Priya Sharma', text: 'Can you explain the difference between WebRTC and RTMP again?', timestamp: new Date(Date.now() - 12 * 60000) },
      { id: 'c2', senderName: 'Prof. Sarah Chen', text: 'Great question! WebRTC is peer-to-peer with <200ms latency, while RTMP uses a media server and typically has 2-5 second delay.', timestamp: new Date(Date.now() - 11 * 60000) },
      { id: 'c3', senderName: 'Alex Rivera', text: 'So for real-time interaction like this classroom, WebRTC is the only option?', timestamp: new Date(Date.now() - 9 * 60000) },
      { id: 'c4', senderName: 'Prof. Sarah Chen', text: 'For sessions under 500 participants, yes. RTMP is better for large broadcasts (10k+) where interaction is limited.', timestamp: new Date(Date.now() - 8 * 60000) },
      { id: 'c5', senderName: 'Liam O\'Brien', text: 'What about the SFU architecture we discussed last week?', timestamp: new Date(Date.now() - 5 * 60000) },
      { id: 'c6', senderName: 'James Wilson', text: 'I think SFU handles the routing so each participant only sends one stream up but receives multiple streams down', timestamp: new Date(Date.now() - 4 * 60000) },
      { id: 'c7', senderName: 'Prof. Sarah Chen', text: 'Exactly right, James! The Selective Forwarding Unit reduces bandwidth requirements compared to mesh topology.', timestamp: new Date(Date.now() - 3 * 60000) },
      { id: 'c8', senderName: 'Mei Lin', text: 'Are breakout rooms handled by the same SFU instance?', timestamp: new Date(Date.now() - 1 * 60000) }
    ];

    // ─── Safe DOM Helpers ───────────────────────────────────────────
    function getInitials(name) {
      return name.split(' ').map(function(n) { return n[0]; }).join('').toUpperCase().slice(0, 2);
    }

    function el(tag, attrs, children) {
      var node = document.createElement(tag);
      if (attrs) {
        Object.keys(attrs).forEach(function(key) {
          if (key === 'className') node.className = attrs[key];
          else if (key === 'textContent') node.textContent = attrs[key];
          else if (key === 'style') Object.assign(node.style, attrs[key]);
          else node.setAttribute(key, attrs[key]);
        });
      }
      if (children) {
        children.forEach(function(child) {
          if (typeof child === 'string') node.appendChild(document.createTextNode(child));
          else if (child) node.appendChild(child);
        });
      }
      return node;
    }

    function svgMutedIcon() {
      var ns = 'http://www.w3.org/2000/svg';
      var svg = document.createElementNS(ns, 'svg');
      svg.setAttribute('class', 'video-muted-icon');
      svg.setAttribute('fill', 'none');
      svg.setAttribute('viewBox', '0 0 24 24');
      svg.setAttribute('stroke', 'currentColor');
      svg.setAttribute('stroke-width', '2');
      var p1 = document.createElementNS(ns, 'path');
      p1.setAttribute('stroke-linecap', 'round');
      p1.setAttribute('stroke-linejoin', 'round');
      p1.setAttribute('d', 'M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z');
      var p2 = document.createElementNS(ns, 'path');
      p2.setAttribute('stroke-linecap', 'round');
      p2.setAttribute('stroke-linejoin', 'round');
      p2.setAttribute('d', 'M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2');
      svg.appendChild(p1);
      svg.appendChild(p2);
      return svg;
    }

    function createSpeakingBars() {
      var container = el('div', { className: 'speaking-bars' });
      for (var i = 0; i < 3; i++) container.appendChild(el('div', { className: 'speaking-bar' }));
      return container;
    }

    // ─── Render Participant Grid (DOM-safe) ─────────────────────────
    function renderParticipantGrid() {
      var grid = document.getElementById('participantGrid');
      while (grid.firstChild) grid.removeChild(grid.firstChild);

      var sorted = participants.slice().sort(function(a, b) {
        if (a.isSpeaking !== b.isSpeaking) return a.isSpeaking ? -1 : 1;
        if (a.isHandRaised !== b.isHandRaised) return a.isHandRaised ? -1 : 1;
        return a.name.localeCompare(b.name);
      });

      var visible = sorted.slice(0, 12);
      var overflow = participants.length - 12;

      visible.forEach(function(p) {
        var tile = el('div', {
          className: 'video-tile video-tile--sm' + (p.isSpeaking ? ' video-tile--speaking' : ''),
          role: 'img',
          'aria-label': p.name + "'s video" + (p.isCameraOff ? ' (camera off)' : '') + (p.isMuted ? ', muted' : '')
        });

        if (p.isCameraOff) {
          var avatarWrap = el('div', { className: 'video-avatar' });
          avatarWrap.appendChild(el('div', { className: 'avatar-circle avatar-circle--sm', textContent: getInitials(p.name) }));
          tile.appendChild(avatarWrap);
        } else {
          tile.appendChild(el('div', { className: 'video-placeholder' }));
        }

        var overlay = el('div', { className: 'video-overlay' });
        overlay.appendChild(el('span', { className: 'video-name', textContent: p.name }));
        if (p.isMuted) overlay.appendChild(svgMutedIcon());
        if (p.isHandRaised) overlay.appendChild(el('span', { textContent: '✋', style: { fontSize: '0.875rem' } }));
        tile.appendChild(overlay);

        tile.appendChild(el('div', { className: 'connection-dot connection-dot--' + p.connectionStatus }));
        if (p.isSpeaking) tile.appendChild(createSpeakingBars());
        grid.appendChild(tile);
      });

      if (overflow > 0) {
        grid.appendChild(el('div', { className: 'overflow-tile', textContent: '+' + overflow + ' more' }));
      }
    }

    // ─── Render Chat Messages (DOM-safe) ────────────────────────────
    function renderChatMessages() {
      var container = document.getElementById('chatMessages');
      while (container.firstChild) container.removeChild(container.firstChild);

      chatMessages.forEach(function(msg) {
        var initials = getInitials(msg.senderName);
        var time = msg.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

        var msgEl = el('div', { className: 'chat-message' }, [
          el('div', { className: 'chat-avatar', textContent: initials }),
          el('div', { className: 'chat-body' }, [
            el('div', { className: 'chat-header' }, [
              el('span', { className: 'chat-sender', textContent: msg.senderName }),
              el('time', { className: 'chat-time', textContent: time })
            ]),
            el('p', { className: 'chat-text', textContent: msg.text })
          ])
        ]);

        container.appendChild(msgEl);
      });

      container.scrollTop = container.scrollHeight;
    }

    // ─── Render Participant List (DOM-safe) ─────────────────────────
    function renderParticipantList() {
      var list = document.getElementById('participantList');
      while (list.firstChild) list.removeChild(list.firstChild);

      var instructor = { id: '0', name: 'Prof. Sarah Chen', isMuted: false, isCameraOff: false, isSpeaking: true, isHandRaised: false, connectionStatus: 'connected' };
      var all = [instructor].concat(participants);

      all.forEach(function(p) {
        var initials = getInitials(p.name);
        var statusColor = p.connectionStatus === 'connected' ? '#34D399' : p.connectionStatus === 'reconnecting' ? '#FBBF24' : '#F87171';

        var avatarWrap = el('div', { className: 'participant-avatar-wrap' }, [
          el('div', { className: 'participant-avatar', textContent: initials })
        ]);
        var statusDot = el('div', { className: 'participant-status-dot' });
        statusDot.style.background = statusColor;
        avatarWrap.appendChild(statusDot);

        var icons = el('div', { className: 'participant-icons' });
        if (p.isHandRaised) icons.appendChild(el('span', { textContent: '✋' }));
        if (p.isMuted) {
          var muteIcon = svgMutedIcon();
          muteIcon.style.width = '0.875rem';
          muteIcon.style.height = '0.875rem';
          muteIcon.setAttribute('class', '');
          muteIcon.style.color = '#F87171';
          icons.appendChild(muteIcon);
        }

        var item = el('li', { className: 'participant-item' }, [
          avatarWrap,
          el('span', { className: 'participant-name', textContent: p.name }),
          icons
        ]);

        list.appendChild(item);
      });
    }

    // ─── Interactions ───────────────────────────────────────────────
    var micMuted = false;
    var cameraOff = false;
    var handRaised = false;

    function toggleMic() {
      micMuted = !micMuted;
      var btn = document.getElementById('micBtn');
      btn.classList.toggle('toolbar-btn--active', micMuted);
      btn.setAttribute('aria-pressed', String(micMuted));
      var tip = btn.querySelector('.tooltip');
      tip.textContent = '';
      tip.appendChild(document.createTextNode(micMuted ? 'Unmute' : 'Mute'));
      var kbd = document.createElement('kbd');
      kbd.textContent = 'M';
      tip.appendChild(kbd);
    }

    function toggleCamera() {
      cameraOff = !cameraOff;
      var btn = document.getElementById('cameraBtn');
      btn.classList.toggle('toolbar-btn--active', cameraOff);
      btn.setAttribute('aria-pressed', String(cameraOff));
      var tip = btn.querySelector('.tooltip');
      tip.textContent = '';
      tip.appendChild(document.createTextNode(cameraOff ? 'Turn on camera' : 'Turn off camera'));
      var kbd = document.createElement('kbd');
      kbd.textContent = 'V';
      tip.appendChild(kbd);
    }

    function toggleHand() {
      handRaised = !handRaised;
      var btn = document.getElementById('handBtn');
      btn.classList.toggle('toolbar-btn--active', handRaised);
      btn.setAttribute('aria-pressed', String(handRaised));
      var emoji = btn.querySelector('.hand-emoji');
      emoji.classList.toggle('hand-emoji--muted', !handRaised);
      var tip = btn.querySelector('.tooltip');
      tip.textContent = '';
      tip.appendChild(document.createTextNode(handRaised ? 'Lower hand' : 'Raise hand'));
      var kbd = document.createElement('kbd');
      kbd.textContent = 'H';
      tip.appendChild(kbd);
    }

    function switchTab(tab) {
      var chatTab = document.getElementById('chatTab');
      var participantsTab = document.getElementById('participantsTab');
      var chatPanel = document.getElementById('chatPanel');
      var participantListPanel = document.getElementById('participantListPanel');

      if (tab === 'chat') {
        chatTab.classList.add('sidebar-tab--active');
        chatTab.setAttribute('aria-selected', 'true');
        participantsTab.classList.remove('sidebar-tab--active');
        participantsTab.setAttribute('aria-selected', 'false');
        chatPanel.style.display = 'flex';
        participantListPanel.style.display = 'none';
      } else {
        participantsTab.classList.add('sidebar-tab--active');
        participantsTab.setAttribute('aria-selected', 'true');
        chatTab.classList.remove('sidebar-tab--active');
        chatTab.setAttribute('aria-selected', 'false');
        chatPanel.style.display = 'none';
        participantListPanel.style.display = 'flex';
      }
    }

    function sendMessage() {
      var input = document.getElementById('chatInput');
      var text = input.value.trim();
      if (!text) return;

      chatMessages.push({
        id: 'c' + (chatMessages.length + 1),
        senderName: 'You',
        text: text,
        timestamp: new Date()
      });

      input.value = '';
      renderChatMessages();
    }

    document.getElementById('chatInput').addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    document.addEventListener('keydown', function(e) {
      var tag = e.target.tagName;
      if (tag === 'INPUT' || tag === 'TEXTAREA') return;
      switch (e.key.toLowerCase()) {
        case 'm': toggleMic(); break;
        case 'v': toggleCamera(); break;
        case 'h': toggleHand(); break;
      }
    });

    // ─── Theme ──────────────────────────────────────────────────────
    function setTheme(theme) {
      if (theme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.getElementById('darkBtn').classList.add('preview-btn--active');
        document.getElementById('lightBtn').classList.remove('preview-btn--active');
      } else {
        document.documentElement.removeAttribute('data-theme');
        document.getElementById('lightBtn').classList.add('preview-btn--active');
        document.getElementById('darkBtn').classList.remove('preview-btn--active');
      }
    }

    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      setTheme('dark');
    }

    // ─── Initial Render ─────────────────────────────────────────────
    renderParticipantGrid();
    renderChatMessages();
    renderParticipantList();
  </script>
</body>
</html>
